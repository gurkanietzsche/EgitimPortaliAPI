@{
    ViewData["Title"] = "Kategori Yönetimi";
}

<!-- Page Heading -->
<div class="d-sm-flex align-items-center justify-content-between mb-4">
    <h1 class="h3 mb-0 text-gray-800">Kategori Yönetimi</h1>
    <button class="d-none d-sm-inline-block btn btn-sm btn-success shadow-sm" id="showAddCategoryModal">
        <i class="fas fa-plus fa-sm text-white-50"></i> Yeni Kategori Ekle
    </button>
</div>

<!-- Content Row -->
<div class="row">
    <div class="col-12">
        <!-- Kategori Listesi -->
        <div class="card shadow mb-4">
            <div class="card-header py-3">
                <h6 class="m-0 font-weight-bold text-success">Kategori Listesi</h6>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-bordered" id="categoriesTable" width="100%" cellspacing="0">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Kategori Adı</th>
                                <th>Açıklama</th>
                                <th>Kurs Sayısı</th>
                                <th>Oluşturulma Tarihi</th>
                                <th>İşlemler</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Kategoriler burada yüklenecek -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <!-- DataTables CSS -->
    <link href="~/sbadmin2/vendor/datatables/dataTables.bootstrap4.min.css" rel="stylesheet">

    <!-- DataTables JS -->
    <script src="~/sbadmin2/vendor/datatables/jquery.dataTables.min.js"></script>
    <script src="~/sbadmin2/vendor/datatables/dataTables.bootstrap4.min.js"></script>

    <!-- Kendi JavaScript Kodunuz -->
    <script>
        $(document).ready(function() {
            let categoriesTable;
            let allCategories = [];

            // DataTables başlatma
            categoriesTable = $('#categoriesTable').DataTable({
                "language": {
                    "lengthMenu": "_MENU_ kayıt göster",
                    "zeroRecords": "Kayıt bulunamadı",
                    "info": "_START_ - _END_ arası, toplam _TOTAL_ kayıt",
                    "infoEmpty": "Kayıt yok",
                    "infoFiltered": "(_MAX_ kayıt içinden filtrelendi)",
                    "search": "Ara:",
                    "paginate": {
                        "first": "İlk",
                        "last": "Son",
                        "next": "Sonraki",
                        "previous": "Önceki"
                    }
                },
                "responsive": true,
                "pageLength": 25,
                "order": [[0, "asc"]]
            });

            // Kategorileri yükle
            loadCategories();

            function loadCategories() {
                $.ajax({
                    url: "/Home/GetCategories",
                    type: "GET",
                    success: function(response) {
                        console.log("API Yanıtı:", response);

                        if (response.success) {
                            allCategories = response.data; // Kategorileri global değişkene ata
                            categoriesTable.clear(); // Tabloyu temizle

                            response.data.forEach(function(category) {
                                categoriesTable.row.add([
                                    category.id || '-', // ID
                                    category.name || '-', // Kategori Adı
                                    category.description || '-', // Açıklama
                                    category.courseCount || 0, // Kurs Sayısı
                                    category.createdDate
                                        ? new Date(category.createdDate).toLocaleDateString('tr-TR')
                                        : '-', // Oluşturulma Tarihi
                                    `
                                    <div class="btn-group" role="group">
                                        <button type="button" class="btn btn-info btn-sm edit-category" data-id="${category.id}">
                                            <i class="fas fa-edit"></i> Düzenle
                                        </button>
                                        <button type="button" class="btn btn-danger btn-sm delete-category" data-id="${category.id}">
                                            <i class="fas fa-trash"></i> Sil
                                        </button>
                                    </div>
                                    ` // İşlemler
                                ]);
                            });

                            categoriesTable.draw(); // Tabloyu yeniden çiz
                            attachCategoryButtons(); // Butonları yeniden bağla
                        } else {
                            alert("Kategoriler yüklenirken hata: " + response.message);
                        }
                    },
                    error: function(xhr, status, error) {
                        console.error("AJAX Hatası:", error);
                    }
                });
            }

            // Butonlara event bağlama
            function attachCategoryButtons() {
                console.log("Butonlar bağlanıyor...");
                $('.edit-category').on('click', function() {
                    const categoryId = $(this).data('id');
                    console.log(`Düzenle butonuna tıklandı. Kategori ID: ${categoryId}`);
                    // Düzenleme işlemleri burada yapılabilir
                });

                $('.delete-category').on('click', function() {
                    const categoryId = $(this).data('id');
                    console.log(`Sil butonuna tıklandı. Kategori ID: ${categoryId}`);
                    // Silme işlemleri burada yapılabilir
                });
            }
        });
    </script>
}